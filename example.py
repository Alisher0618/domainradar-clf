#!/usr/bin/env python3

# Example use

import pandas as pd
from pandas import Timedelta
from classifiers.pipeline import Pipeline

p = Pipeline()

# Create a Pandas DataFrame with domains' feature vectors
df = pd.DataFrame({
    "domain_name": ['44445344.xyz', 'dot-pl.web.app', 'cdn.csml.dev', 'mpipes.com.hr', 'film-serial.webnode.page'],
    # "label": ['phishing', 'malware', 'benign', 'benign', 'benign'], # Label is not known for classification
    "dns_has_dnskey": [1.0, 0.0, 0.0, 0.0, 0.0],
    "dns_A_count": [0, 1, 4, 1, 0],
    "dns_AAAA_count": [0, 1, 0, 0, 0],
    "dns_MX_count": [0, 0, 0, 1, 0],
    "dns_NS_count": [0, 0, 0, 2, 0],
    "dns_TXT_count": [0, 0, 0, 0, 0],
    "dns_SOA_count": [0, 0, 0, 1, 0],
    "dns_CNAME_count": [0, 0, 0, 0, 1],
    "dns_zone_level": [0, 0, 0, 0, 0],
    "dns_zone_digit_count": [0, 0, 0, 0, 0],
    "dns_zone_len": [3, 7, 8, 13, 12],
    "dns_zone_entropy": [0.5283208335737187, 0.3602343766204741, 0.375, 0.24914625050789468, 0.26572682296173894],
    "dns_resolved_record_types": [0, 2, 1, 4, 1],
    "dns_dnssec_score": [0.0, 0.0, 0.0, 0.0, 0.0],
    "dns_ttl_avg": [0.0, 24685.714285714286, 8.571428571428571, 28800.0, 514.2857142857143],
    "dns_ttl_stdev": [0.0, 39031.54140550685, 20.99562636671296, 36914.10880099137, 1259.7375820027776],
    "dns_ttl_low": [1.0, 0.7142857142857143, 1.0, 0.42857142857142855, 0.8571428571428571],
    "dns_ttl_mid": [0.0, 0.0, 0.0, 0.0, 0.0],
    "dns_ttl_distinct_count": [1.0, 2.0, 2.0, 3.0, 2.0],
    "dns_soa_primary_ns_level": [None, None, None, 1.0, None],
    "dns_soa_primary_ns_digit_count": [None, None, None, 1.0, None],
    "dns_soa_primary_ns_len": [None, None, None, 24.0, None],
    "dns_soa_primary_ns_entropy": [None, None, None, 0.16195175783879218, None],
    "dns_soa_email_level": [None, None, None, 1.0, None],
    "dns_soa_email_digit_count": [None, None, None, 0.0, None],
    "dns_soa_email_len": [None, None, None, 21.0, None],
    "dns_soa_email_entropy": [None, None, None, 0.16834164598266202, None],
    "dns_soa_refresh": [None, None, None, 3600.0, None],
    "dns_soa_retry": [None, None, None, 1800.0, None],
    "dns_soa_expire": [None, None, None, 1209600.0, None],
    "dns_soa_min_ttl": [None, None, None, 86400.0, None],
    "dns_domain_name_in_mx": [False, False, False, True, False],
    "dns_mx_avg_len": [None, None, None, 13.0, None],
    "dns_mx_avg_entropy": [None, None, None, 0.24914625050789468, None],
    "dns_txt_avg_len": [None, None, None, None, None],
    "dns_txt_avg_entropy": [None, None, None, None, None],
    "dns_txt_external_verification_score": [0, 0, 0, 0, 0],
    "dns_txt_spf_exists": [0, 0, 0, 0, 0],
    "dns_txt_dkim_exists": [0, 0, 0, 0, 0],
    "dns_txt_dmarc_exists": [0, 0, 0, 0, 0],
    "ip_count": [0, 2, 4, 3, 2],
    "ip_mean_average_rtt": [-1.0, 23.277, 3.83875, 16.784333333333333, 0.0],
    "ip_v4_ratio": [0.0, 0.5, 1.0, 1.0, 0.0],
    "ip_a_aaaa_to_all_ratio": [0.0, 1.0, 1.0, 0.3333333333333333, 0.0],
    "ip_entropy": [-0.0, -0.0, -0.0, 0.9182958340544896, 1.0],
    "ip_as_address_entropy": [None, -0.0, -0.0, 0.9182958340544896, -0.0],
    "ip_asn_entropy": [None, -0.0, -0.0, -0.0, -0.0],
    "ip_distinct_as_count": [None, 1.0, 1.0, 1.0, 1.0],
    "tls_has_tls": [False, True, True, True, True],
    "tls_chain_len": [None, 3.0, 4.0, 3.0, 3.0],
    "tls_is_self_signed": [None, 0.0, 0.0, 0.0, 0.0],
    "tls_root_authority_hash": [None, 484934813.0, 258194425.0, 484934813.0, 484934813.0],
    "tls_leaf_authority_hash": [None, 484934813.0, 1688716273.0, 484934813.0, 484934813.0],
    "tls_negotiated_version_id": [None, 3.0, 3.0, 3.0, 3.0],
    "tls_negotiated_cipher_id": [None, 1.0, 1.0, 2.0, 2.0],
    "tls_root_cert_validity_len": [None, -1.0, 9066.0, -1.0, -1.0],
    "tls_leaf_cert_validity_len": [None, -1.0, 395.0, -1.0, -1.0],
    "tls_broken_chain": [None, 0.0, 0.0, 0.0, 0.0],
    "tls_expired_chain": [None, 1.0, 0.0, 1.0, 1.0],
    "tls_total_extension_count": [None, -1.0, 31.0, -1.0, -1.0],
    "tls_critical_extensions": [None, -1.0, 7.0, -1.0, -1.0],
    "tls_with_policies_crt_count": [None, 0.0, 4.0, 0.0, 0.0],
    "tls_percentage_crt_with_policies": [None, 0.0, 1.0, 0.0, 0.0],
    "tls_x509_anypolicy_crt_count": [None, 0.0, 2.0, 0.0, 0.0],
    "tls_iso_policy_crt_count": [None, 0.0, 0.0, 0.0, 0.0],
    "tls_joint_isoitu_policy_crt_count": [None, 0.0, 2.0, 0.0, 0.0],
    "tls_subject_count": [None, 0.0, 1.0, 0.0, 0.0],
    "tls_server_auth_crt_count": [None, 0.0, 2.0, 0.0, 0.0],
    "tls_client_auth_crt_count": [None, 0.0, 2.0, 0.0, 0.0],
    "tls_CA_certs_in_chain_ratio": [None, 0.0, 0.5, 0.0, 0.0],
    "tls_unique_SLD_count": [None, 0.0, 1.0, 0.0, 0.0],
    "tls_common_name_count": [None, 0.0, 3.0, 0.0, 0.0],
    "lex_name_len": [12, 14, 12, 13, 24],
    "lex_has_digit": [1, 0, 0, 0, 0],
    "lex_phishing_keyword_count": [0, 2, 0, 0, 1],
    "lex_benign_keyword_count": [0, 0, 1, 0, 0],
    "lex_consecutive_chars": [4, 2, 1, 1, 1],
    "lex_tld_len": [3, 3, 3, 6, 4],
    "lex_tld_abuse_score": [0.0072, 0.0, 0.0, 0.0, 0.0],
    "lex_tld_hash": [273495511, 2544419962, 1684069674, 3678232217, 4285916283],
    "lex_sld_len": [8, 3, 4, 6, 7],
    "lex_sld_norm_entropy": [0.13265976555739162, 0.5283208335737187, 0.5, 0.3752715278979704, 0.3602343766204741],
    "lex_sld_digit_count": [8.0, 0.0, 0.0, 0.0, 0.0],
    "lex_sld_digit_ratio": [1.0, 0.0, 0.0, 0.0, 0.0],
    "lex_sld_phishing_keyword_count": [0, 1, 0, 0, 1],
    "lex_sld_vowel_count": [0, 1, 0, 2, 3],
    "lex_sld_vowel_ratio": [0.0, 0.3333333333333333, 0.0, 0.3333333333333333, 0.42857142857142855],
    "lex_sld_consonant_count": [0, 2, 4, 4, 4],
    "lex_sld_consonant_ratio": [0.0, 0.6666666666666666, 1.0, 0.6666666666666666, 0.5714285714285714],
    "lex_sld_non_alphanum_count": [0, 0, 0, 0, 0],
    "lex_sld_non_alphanum_ratio": [0.0, 0.0, 0.0, 0.0, 0.0],
    "lex_sld_hex_count": [8, 2, 1, 1, 4],
    "lex_sld_hex_ratio": [1.0, 0.6666666666666666, 0.25, 0.16666666666666666, 0.5714285714285714],
    "lex_sub_count": [0, 1, 1, 0, 1],
    "lex_stld_unique_char_count": [6, 5, 7, 9, 9],
    "lex_begins_with_digit": [1, 0, 0, 0, 0],
    "lex_www_flag": [0, 0, 0, 0, 0],
    "lex_sub_max_consonant_len": [0, 3, 7, 2, 2],
    "lex_sub_norm_entropy": [0.13265976555739162, 0.3522138890491458, 0.3602343766204741, 0.3752715278979704,
                             0.2046412423574017],
    "lex_sub_digit_count": [8.0, 0.0, 0.0, 0.0, 0.0],
    "lex_sub_digit_ratio": [1.0, 0.0, 0.0, 0.0, 0.0],
    "lex_sub_vowel_count": [0, 2, 0, 2, 7],
    "lex_sub_vowel_ratio": [0.0, 0.2222222222222222, 0.0, 0.3333333333333333, 0.3888888888888889],
    "lex_sub_consonant_count": [0, 6, 7, 4, 10],
    "lex_sub_consonant_ratio": [0.0, 0.6666666666666666, 1.0, 0.6666666666666666, 0.5555555555555556],
    "lex_sub_non_alphanum_count": [0, 1, 0, 0, 1],
    "lex_sub_non_alphanum_ratio": [0.0, 0.1111111111111111, 0.0, 0.0, 0.05555555555555555],
    "lex_sub_hex_count": [8, 3, 3, 1, 7],
    "lex_sub_hex_ratio": [1.0, 0.3333333333333333, 0.42857142857142855, 0.16666666666666666, 0.3888888888888889],
    "lex_phishing_bigram_matches": [2, 7, 3, 4, 13],
    "lex_phishing_trigram_matches": [2, 3, 0, 0, 9],
    "lex_phishing_tetragram_matches": [0, 0, 0, 0, 4],
    "lex_phishing_pentagram_matches": [0, 0, 0, 0, 4],
    "lex_malware_bigram_matches": [0, 5, 5, 5, 13],
    "lex_malware_trigram_matches": [0, 2, 1, 2, 8],
    "lex_malware_tetragram_matches": [0, 0, 0, 0, 1],
    "lex_dga_bigram_matches": [4, 6, 6, 5, 15],
    "lex_dga_trigram_matches": [0, 0, 1, 3, 5],
    "lex_dga_tetragram_matches": [0, 0, 0, 0, 1],
    "lex_avg_part_len": [5.5, 4.0, 3.3333333333333335, 3.6666666666666665, 7.333333333333333],
    "lex_stdev_part_lens": [2.5, 1.4142135623730951, 0.4714045207910317, 1.699673171197595, 2.8674417556808756],
    "lex_longest_part_len": [8, 6, 4, 6, 11],
    "lex_short_part_count": [1, 2, 2, 2, 0],
    "lex_medium_part_count": [1, 1, 1, 1, 2],
    "lex_long_part_count": [0, 0, 0, 0, 1],
    "lex_superlong_part_count": [0, 0, 0, 0, 0],
    "lex_shortest_sub_len": [8, 9, 7, 6, 18],
    "lex_ipv4_in_domain": [0, 0, 0, 0, 0],
    "lex_has_trusted_suffix": [0, 0, 0, 0, 0],
    "lex_has_wellknown_suffix": [0, 0, 0, 0, 0],
    "lex_has_cdn_suffix": [0, 0, 0, 0, 0],
    "lex_has_vps_suffix": [0, 0, 0, 0, 0],
    "lex_has_img_suffix": [0, 0, 0, 0, 0],
    "lex_suffix_score": [0, 0, 0, 0, 0],
    "geo_countries_count": [0, 1, 1, 1, 1],
    "geo_continents_count": [0, 1, 1, 1, 1],
    "geo_malic_host_country": [0, 1, 1, 0, 0],
    "geo_lat_stdev": [0.0, 0.0, 0.0, 1.3193669727899393, 0.0],
    "geo_lon_stdev": [0.0, 0.0, 0.0, 1.1708745487407648, 0.0],
    "geo_mean_lat": [0.0, 37.751, 37.751, 49.467733333333335, 50.1188],
    "geo_mean_lon": [0.0, -97.822, -97.822, 8.221566666666666, 8.6843],
    "geo_min_lat": [0.0, 37.751, 37.751, 48.5348, 50.1188],
    "geo_max_lat": [0.0, 37.751, 37.751, 51.3336, 50.1188],
    "geo_min_lon": [0.0, -97.822, -97.822, 6.5657, 8.6843],
    "geo_max_lon": [0.0, -97.822, -97.822, 9.0495, 8.6843],
    "geo_lat_range": [0.0, 0.0, 0.0, 2.7988, 0.0],
    "geo_lon_range": [0.0, 0.0, 0.0, 2.4838000000000005, 0.0],
    "geo_centroid_lat": [0.0, 56.62649999999999, 56.62649999999999, 74.2016, 75.1782],
    "geo_centroid_lon": [0.0, -146.733, -146.733, 11.09045, 13.02645],
    "geo_estimated_area": [0.0, 0.0, 0.0, 6.951659440000001, 0.0],
    "geo_continent_hash": [0, 1, 1, 3, 3],
    "geo_countries_hash": [0, 187, 187, 65, 65],
    "rdap_registration_period": [Timedelta('365 days 03:25:50'), Timedelta('2192 days 00:00:00'),
                                 Timedelta('1827 days 00:00:00'), Timedelta('3653 days 00:00:00'),
                                 Timedelta('1461 days 00:00:00')],
    "rdap_domain_age": [482.1429513888889, 1953.0798148148149, 1727.4995717592592, 3689.0833333333335,
                        1161.1051851851853],
    "rdap_time_from_last_change": [457.2892824074074, 154.57892361111112, 221.49957175925925, 3689.0833333333335,
                                   815.4650347222222],
    "rdap_domain_active_time": [365.14293981481484, 1953.0798148148149, 1727.4995717592592, 3653.0, 1161.1051851851853],
    "rdap_has_dnssec": [False, False, False, False, False],
    "rdap_registrar_name_len": [9, 16, 27, 0, 22],
    "rdap_registrar_name_entropy": [0.3028311729997631, 0.21875, 0.15208804877103807, 0.0, 0.16551135456615812],
    "rdap_registrar_name_hash": [1751207475, 4215097277, 3912328311, 4294967295, 3897680919],
    "rdap_registrant_name_len": [52, 30, 40, 0, 10],
    "rdap_registrant_name_entropy": [0.0765247446216602, 0.1405020337401023, 0.10663278830562754, 0.0,
                                     0.3121928094887362],
    "rdap_admin_name_len": [0, 0, 0, 0, 0],
    "rdap_admin_name_entropy": [0.0, 0.0, 0.0, 0.0, 0.0],
    "rdap_admin_email_len": [0, 0, 0, 0, 0],
    "rdap_admin_email_entropy": [0.0765247446216602, 0.1405020337401023, 0.10663278830562754, 0.0, 0.3121928094887362],
    "rdap_ip_v4_count": [0, 1, 4, 3, 2],
    "rdap_ip_v6_count": [0, 1, 0, 0, 0],
    "rdap_ip_shortest_v4_prefix_len": [0, 21, 17, 15, 12],
    "rdap_ip_longest_v4_prefix_len": [0, 21, 17, 26, 12],
    "rdap_ip_shortest_v6_prefix_len": [0, 48, 0, 0, 0],
    "rdap_ip_longest_v6_prefix_len": [0, 48, 0, 0, 0],
    "rdap_ip_avg_admin_name_len": [0.0, 10.0, 13.0, 13.0, 13.0],
    "rdap_ip_avg_admin_name_entropy": [0.0, 0.2921928094887362, 0.24914625050789468, 0.24914625050789466,
                                       0.24914625050789468],
    "rdap_ip_avg_admin_email_len": [0.0, 23.0, 23.0, 17.0, 23.0],
    "rdap_ip_avg_admin_email_entropy": [0.0, 0.15744241490954225, 0.14988097823657437, 0.22398609273042325,
                                        0.14988097823657437],
})

results = p.classify_domains(df)

print(results)
